{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\admin\\controller\\content.js"
    ],
    "names": [
        "indexAction",
        "articlelist",
        "result",
        "list",
        "selval",
        "get",
        "searchtxt",
        "pagenumber",
        "pagesize",
        "map",
        "model",
        "getArticleJoinRecord",
        "getPageCountSelect",
        "assign",
        "title",
        "_logic",
        "Page",
        "think",
        "adapter",
        "page",
        "http",
        "pageData",
        "pagination",
        "config",
        "pageSize",
        "redirect",
        "display",
        "draftlistAction",
        "ispublished",
        "getDraftJoinRecord",
        "tags",
        "on",
        "articleAction",
        "findAll",
        "tagsList",
        "itemList",
        "findOne",
        "id",
        "article",
        "picurl",
        "tag_selected_id",
        "tag",
        "item_selected_id",
        "item",
        "addmarkdownAction",
        "doaddAction",
        "mycreatetime",
        "datetime",
        "post",
        "data",
        "createtime",
        "isEmpty",
        "updateRecord",
        "rs",
        "success",
        "addRecord",
        "articleinfo",
        "updatestatusAction",
        "pid",
        "delsomeAction",
        "arr",
        "where",
        "deleteRecord",
        "uploadAction",
        "IS_USE_OSS",
        "ALIOSS",
        "service",
        "alioss",
        "file",
        "extend",
        "upload",
        "console",
        "log",
        "json",
        "path",
        "name",
        "filepath",
        "newpath",
        "liFormatDate",
        "Date",
        "toLocaleDateString",
        "uploadPath",
        "UPLOAD_PATH",
        "mkdir",
        "basename",
        "renameSync",
        "uploadeditorAction",
        "uploadfileAction",
        "encodeHTMLContent",
        "str",
        "replace",
        "marked",
        "require",
        "setOptions",
        "renderer",
        "Renderer",
        "gfm",
        "tables",
        "breaks",
        "pedantic",
        "sanitize",
        "smartLists",
        "smartypants",
        "getContent",
        "html",
        "newHtml",
        "ainfo",
        "ainfo_obj",
        "indexOf",
        "end",
        "note",
        "substr",
        "JSON",
        "parse",
        "fail",
        "articlehtml"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\admin\\controller\\content.js",
    "sourcesContent": [
        "'use strict';\n\nimport fs from \"fs\";\nimport path from \"path\";\nimport Base from './base.js';\n\nexport default class extends Base\n{\n    /**\n     * index action\n     * @return {Promise} []\n     */\n    async indexAction()\n    {\n        let articlelist ={},result={},list={};\n        let selval=this.get('type');\n        let searchtxt=this.get('search');\n        let pagenumber=this.get('page')||1;\n        let pagesize=this.get('pagesize')||1;\n        // 设置分页\n        if(selval){\n            //文章筛选\n            let map={};\n            map[this.get('type')]=1;\n            articlelist = await this.model(\"admin\").getArticleJoinRecord(map,pagenumber,pagesize);\n            result = await this.model(\"admin\").getPageCountSelect(map,pagenumber,pagesize);\n            this.assign(\"type\", selval);\n        }else if(searchtxt){\n            //文章搜索\n            let map={title: [\"like\", \"%\"+searchtxt+\"%\"],['li_article.id']:[\"like\", \"%\"+searchtxt*1+\"%\"],_logic: \"OR\"};\n            articlelist = await this.model(\"admin\").getArticleJoinRecord(map,pagenumber,pagesize);\n            result = await this.model(\"admin\").getPageCountSelect(map,pagenumber,pagesize);\n            this.assign(\"type\", '');\n        }else{\n            let map={};\n            articlelist = await this.model(\"admin\").getArticleJoinRecord(map,pagenumber,pagesize);\n            result = await this.model(\"admin\").getPageCountSelect(map,pagenumber,pagesize);\n            this.assign(\"type\", '');\n        }\n        let Page = think.adapter(\"template\", \"page\");\n        let page = new Page(this.http);\n        let pageData = page.pagination(result);\n        this.assign(\"articlelist\", articlelist);\n        this.assign('pageData', pageData);\n\n        // 设置分页\n        let pageSize = await this.config(\"pagesize\");\n        if (!this.get(\"page\")) {\n            return this.redirect(\"/admin/content/index?page=1&pagesize=\" + pageSize);\n        }\n        this.assign(\"title\", \"文章管理\");\n        this.assign(\"pagecount\",this.get(\"page\"));\n        this.assign(\"pagesize\",pageSize);\n        this.assign('isdraft', false);\n        return this.display();\n    }\n\n    async draftlistAction(){\n        // 设置分页\n        let map={ispublished:0};\n        let pagenumber=this.get('page')|1;\n        let pagesize=this.get('pagesize')|1;\n        let articlelist = await this.model(\"admin\").getDraftJoinRecord({\n            tags: {on: \"tag, id\"}\n        },map,pagenumber,pagesize);\n        let result = await this.model(\"admin\").getPageCountSelect(map,pagenumber,pagesize);\n        let Page = think.adapter(\"template\", \"page\");\n        let page = new Page(this.http);\n        let pageData = page.pagination(result);\n        this.assign(\"articlelist\", articlelist);\n        this.assign('pageData', pageData);\n        this.assign('isdraft', true);\n\n        // 设置分页\n        let pageSize = await this.config(\"pagesize\");\n        if (!this.get(\"page\")) {\n            return this.redirect(\"/admin/content/draftlist?page=1&pagesize=\" + pageSize);\n        }\n        this.assign(\"title\", \"草稿箱列表\");\n        this.assign(\"pagecount\",this.get(\"page\"));\n        this.assign(\"pagesize\",pageSize);\n        return this.display('index');\n    }\n    //文章编辑/新增\n    async articleAction()\n    {\n        //获取分类\n        let tagsList=await this.model(\"admin\").findAll(\"tags\");\n        this.assign(\"tagsList\",tagsList);\n        //获取类型\n        let itemList=await this.model(\"admin\").findAll(\"item\");\n        this.assign(\"itemList\",itemList);\n        //编辑或者新增\n        if (this.get('id')) {\n            let article = await this.model('admin').findOne('article',{id:this.get('id')});\n            let picurl=(article.picurl==='')?'/static/common/images/common/default.jpg':article.picurl;\n            let tag_selected_id=article.tag;\n            let item_selected_id=article.item;\n            if(tag_selected_id){\n                this.assign(\"tagselectedId\",tag_selected_id);\n            }else{\n                this.assign(\"tagselectedId\",'');\n            }\n            if(item_selected_id){\n                this.assign(\"itemselectedId\",item_selected_id);\n            }else{\n                this.assign(\"itemselectedId\",'');\n            }\n            this.assign(\"piccss\", 'background-image: url('+picurl+');background-size:82px 82px;');\n            this.assign(\"picurl\", picurl);\n            this.assign('article', article);\n\n            this.assign(\"title\", \"文章编辑\");\n\n        } else {\n            this.assign('article', {});\n            this.assign(\"selectedId\",'');\n            this.assign(\"picurl\", '');\n            this.assign(\"piccss\",'');\n            this.assign(\"tagselectedId\",'');\n            this.assign(\"itemselectedId\",'');\n            this.assign(\"title\", \"文章添加\");\n        }\n        this.assign('ismarkdown',false);//不显示markdown导入\n        return this.display();\n    }\n\n    //新增markdown文章\n    async addmarkdownAction()\n    {\n        //获取分类\n        let tagsList=await this.model(\"admin\").findAll(\"tags\");\n        this.assign(\"tagsList\",tagsList);\n        //获取类型\n        let itemList=await this.model(\"admin\").findAll(\"item\");\n        this.assign(\"itemList\",itemList);\n        //新增\n        this.assign(\"title\", \"markdown文章添加\");\n        this.assign('article', {});\n        this.assign(\"selectedId\",'');\n        this.assign(\"picurl\", '');\n        this.assign(\"piccss\",'');\n        this.assign(\"tagselectedId\",'');\n        this.assign(\"itemselectedId\",'');\n        this.assign('ismarkdown',true);\n        return this.display('article');\n\n    }\n\n    //新增/编辑文章提交接口\n    async doaddAction()\n    {   //编辑或者新增\n        let mycreatetime=think.datetime(this.post('createtime'));\n        let data=await this.post();\n        data.createtime=mycreatetime;\n        if(!think.isEmpty(this.post(\"id\"))){\n            let rs=await this.model(\"admin\").updateRecord(\"article\",{},data);\n            if(rs) return this.success();\n        }else{\n            let articleinfo=await this.model(\"admin\").addRecord(\"article\",data);\n            return this.success({id:articleinfo});\n        }\n    }\n\n    async updatestatusAction()\n    {   //草稿箱发布接口\n        let pid=await this.post(\"id\");\n        if(!think.isEmpty(pid)){\n           let rs=await this.model(\"admin\").updateRecord(\"article\",{id:pid},{ispublished:1});\n            if(rs){\n                return this.success();\n            }\n        }\n    }\n    //删除或批量删除接口\n    async delsomeAction(){\n        let arr=await this.post('delarr[]');\n        let where={id: [\"IN\", arr]};\n        let rs=await this.model(\"admin\").deleteRecord(\"article\",where);\n        if(rs){\n            //操作成功\n            return this.success();\n        }\n    }\n\n    //上传图片接口\n    async uploadAction()\n    {\n\n        let IS_USE_OSS=think.config('OSS.on');\n        if(IS_USE_OSS){\n            //上传OSS图片接口\n            let ALIOSS = think.service(\"alioss\");\n            let alioss = new ALIOSS();\n            let file = think.extend({}, this.file('file'));\n            let rs=await alioss.upload(file);\n            console.log(rs);\n            if(rs){\n                return this.json({path: think.config('OSS.domain')+\"/\"+rs.name});\n            }else{\n                return this.json(\"上传失败！\");\n            }\n        }else{\n            //上传应用服务器图片接口\n            let file = think.extend({}, this.file('file'));\n            let filepath = file.path;\n            let newpath = liFormatDate(new Date().toLocaleDateString());\n            let uploadPath = think.UPLOAD_PATH + '/pics/' + newpath;\n            think.mkdir(uploadPath);\n            let basename = path.basename(filepath);\n            fs.renameSync(filepath, uploadPath + basename);\n            this.json({path: \"/static/upload/pics/\" + newpath + basename});\n        }\n    }\n\n    //上传阿里云OSS图片接口\n    async uploadeditorAction()\n    {\n        let IS_USE_OSS=think.config('OSS.on');\n        if(IS_USE_OSS){\n            //上传OSS图片接口\n            let ALIOSS = think.service(\"alioss\");\n            let alioss = new ALIOSS();\n            let file = think.extend({}, this.file('thumb_img'));\n            let rs=await alioss.upload(file);\n            if(rs){\n                return this.json(think.config('OSS.domain')+\"/\"+rs.name);\n            }else{\n                return this.json(\"上传失败！\");\n            }\n        }else{\n            //上传应用服务器图片接口\n            let file = think.extend({}, this.file('thumb_img'));\n            let filepath = file.path;\n            let newpath = liFormatDate(new Date().toLocaleDateString());\n            let uploadPath = think.UPLOAD_PATH + '/pics/' + newpath;\n            think.mkdir(uploadPath);\n            let basename = path.basename(filepath);\n            fs.renameSync(filepath, uploadPath + basename);\n            this.json(\"/static/upload/pics/\" + newpath + basename);\n        }\n    }\n    //上传markdown文件及解析接口、内容分页\n    async uploadfileAction()\n    {\n        let marked = require('marked');\n        marked.setOptions({\n            renderer: new marked.Renderer(),\n            gfm: true,\n            tables: true,\n            breaks: true,\n            pedantic: false,\n            sanitize: true,\n            smartLists: true,\n            smartypants: false\n        });\n\n        let file = think.extend({}, this.file('file'));\n        let data = await getContent(file.path);\n        let html = await marked(data);\n\n        function encodeHTMLContent(str) {\n            return str.replace(/&quot;/g, '\"').replace(/&lt;!--/g,\"<!--\").replace(/--&gt;/g,\"-->\");\n        }\n\n        let newHtml=encodeHTMLContent(html),ainfo={};\n        if(newHtml){\n            let ainfo_obj;\n            if(newHtml.indexOf(\"<!--\")>0 && newHtml.indexOf(\"-->\")>0){\n                //获取注释信息\n                let end=newHtml.indexOf(\"-->\")-1;\n                let note=newHtml.substr(0,newHtml.indexOf(\"-->\")-1)\n                if(note.indexOf(\"{\")>=0 && note.indexOf(\"-\")>0){\n                    ainfo=note.substr(note.indexOf(\"{\"),end);\n                }\n                try{\n                    ainfo_obj = JSON.parse(ainfo);\n                }catch(err){\n                    //通过 err.message 拿到具体的错误信息\n                    return this.fail(1000, '解析错误！请检查文章配置项!');\n                }\n                this.json({articlehtml:newHtml,ainfo:ainfo_obj});\n            }else{\n                this.json({articlehtml:html});\n            }\n        }\n    };\n\n}\n"
    ]
}