{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\personal\\controller\\index.js"
    ],
    "names": [
        "indexAction",
        "assign",
        "session",
        "uinfo",
        "get",
        "uname",
        "isself",
        "isselftag",
        "think",
        "isEmpty",
        "islogin",
        "name",
        "cache",
        "model",
        "getPointList",
        "pointList",
        "getMytopic",
        "author",
        "topicList",
        "findAll",
        "replyList",
        "getMycollect",
        "collectList",
        "userinfo",
        "id",
        "ranking",
        "undefined",
        "getAllPoint",
        "allPoints",
        "i",
        "length",
        "displayView",
        "settingAction",
        "savecollectAction",
        "post",
        "data",
        "mycreatetime",
        "datetime",
        "deleteRecord",
        "cid",
        "rs",
        "decrepoint",
        "config",
        "points",
        "success",
        "status",
        "msg",
        "createtime",
        "addRecord",
        "increpoint"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\personal\\controller\\index.js",
    "sourcesContent": [
        "'use strict';\r\n\r\nimport Base from './base.js';\r\nexport default class extends Base {\r\n    /**\r\n     * index action\r\n     * @return {Promise} []\r\n     */\r\n    async indexAction() {\r\n        this.assign(\"title\", \"个人中心\");\r\n        let uinfo = await this.session('uInfo');\r\n        let uname = await this.get('uname');\r\n        let isself, isselftag;\r\n        if (!think.isEmpty(uname)) {\r\n            // 是否登录\r\n            let islogin = (!think.isEmpty(uinfo)) ? 1 : 0;\r\n            //是否本人\r\n            if (!think.isEmpty(uinfo)) {\r\n                //登录\r\n                if (uinfo.name === uname) {\r\n                    isselftag = \"我的\";\r\n                    isself = 1;\r\n                } else {\r\n                    isselftag = \"Ta的\";\r\n                    isself = 0;\r\n                }\r\n            } else {\r\n                // 未登录\r\n                isselftag = \"Ta的\";\r\n                isself = 0;\r\n            }\r\n            this.assign(\"islogin\", islogin);\r\n            this.assign(\"isself\", isself);\r\n            this.assign(\"isselftag\", isselftag);\r\n            // 排行\r\n            let pointList = await think.cache(\"pointList\", () => {\r\n                return this.model(\"personal\").getPointList();\r\n            });\r\n            this.assign(\"pointList\", pointList);\r\n\r\n            //我的话题\r\n            let topicList = await this.model('personal').getMytopic({ author: uname });\r\n            this.assign(\"topicList\", topicList);\r\n\r\n            //我的回复\r\n            let replyList = await this.model('personal').findAll('topic_comment', { author: uname });\r\n            this.assign(\"replyList\", replyList);\r\n\r\n            //我的收藏\r\n            let collectList = await this.model('personal').getMycollect({ author: uname });\r\n            this.assign(\"collectList\", collectList);\r\n\r\n            let userinfo = await this.model('personal').findAll('user', { name: uname });\r\n            if (!think.isEmpty(userinfo)) {\r\n                // 个人排名\r\n                let ranking = await think.cache(\"ranking_\" + userinfo[0].id);\r\n                if (ranking === undefined) {\r\n                    let allPoints = await this.model(\"personal\").getAllPoint();\r\n                    for (var i = 0; i < allPoints.length; i++) {\r\n                        if (allPoints[i].id == userinfo[0].id) {\r\n                            ranking = i+1;\r\n                            think.cache(\"ranking_\" + userinfo[0].id, ranking);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                this.assign(\"ranking\", ranking);\r\n\r\n                //他人的个人中心基本信息\r\n                this.assign(\"userinfo\", userinfo[0]);\r\n                return this.displayView(\"index_index\");\r\n\r\n            } else {\r\n                return this.displayView(\"../common/error_404\");\r\n            }\r\n        } else {\r\n            return this.displayView(\"../common/error_404\");\r\n        }\r\n\r\n    }\r\n    async settingAction() {\r\n        return this.displayView(\"index_setting\");\r\n    }\r\n\r\n    //收藏/取消收藏接口\r\n    async savecollectAction() {\r\n        let data = await this.post();\r\n        let mycreatetime = think.datetime(this.post(\"createtime\"));\r\n        if (!think.isEmpty(this.post(\"cid\"))) {\r\n            //已收藏，这里取消收藏。\r\n            let rs = await this.model(\"personal\").deleteRecord(\"user_collect\", { id: data.cid });\r\n            let points = await this.model(\"personal\").decrepoint({ name: data.author }, this.config('point.addcollect'));\r\n            if (rs) return this.success({ status: 0, msg: \"取消收藏成功！\", cid: data.cid });\r\n        } else {\r\n            //未收藏，这里收藏\r\n            data.createtime = mycreatetime;\r\n            let rs = await this.model(\"personal\").addRecord(\"user_collect\", data);\r\n            let points = await this.model(\"personal\").increpoint({ name: data.author }, this.config('point.addcollect'));\r\n            if (rs) return this.success({ status: 1, msg: \"收藏成功！\", cid: rs });\r\n        }\r\n    }\r\n}"
    ]
}