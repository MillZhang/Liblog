{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\topic\\controller\\index.js"
    ],
    "names": [
        "indexAction",
        "tab",
        "get",
        "assign",
        "map",
        "menu",
        "show",
        "item",
        "pagenumber",
        "pagesize",
        "model",
        "getPageSelect",
        "itemList",
        "getPageCountSelect",
        "result",
        "Page",
        "think",
        "adapter",
        "page",
        "http",
        "pageData",
        "pagination",
        "findAll",
        "tablist",
        "displayView",
        "itemAction",
        "tid",
        "session",
        "uinfo",
        "islogin",
        "isEmpty",
        "name",
        "loginuserinfo",
        "aid",
        "type",
        "author",
        "iscollect",
        "collectList",
        "length",
        "id",
        "getReplyListInfo",
        "replyList",
        "findOne",
        "topicInfo",
        "topicItem",
        "where",
        "increment",
        "viewcount",
        "replycount",
        "comment",
        "editAction",
        "replyInfo"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\topic\\controller\\index.js",
    "sourcesContent": [
        "'use strict';\r\n\r\nimport Base from './base.js';\r\n\r\nexport default class extends Base {\r\n  /**\r\n   * index action\r\n   * @return {Promise} []\r\n   */\r\n  async indexAction(){\r\n       let tab=this.get(\"tab\");\r\n       this.assign(\"title\",\"社区\");\r\n       let map,menu;\r\n       if(tab==='all'||tab===''){\r\n         map={show:1};\r\n         menu=\"all\";\r\n       }else{\r\n         map={item:tab,show:1};\r\n         menu=tab;\r\n       }\r\n      //  let topicList=await this.model('topic').getTopicListJoinRecord(map);\r\n        let pagenumber=this.get(\"page\")||1;\r\n        let pagesize=this.get(\"pagesize\")||20;\r\n       //分页\r\n        let itemList=await this.model(\"topic\").getPageSelect(map,pagenumber,pagesize);\r\n        let result = await this.model(\"topic\").getPageCountSelect(map,pagenumber,pagesize);\r\n        var Page=think.adapter(\"template\", \"page\");\r\n        var page = new Page(this.http);\r\n        var pageData=page.pagination(result);\r\n\r\n        this.assign(\"itemList\",itemList);\r\n        this.assign('pageData',pageData);\r\n        this.assign('menu',\"topic/\"+menu);\r\n       //分页\r\n       //  tab列表\r\n       let tablist=await this.model(\"topic\").findAll(\"topic_item\");\r\n       this.assign(\"tablist\",tablist);\r\n       //  tab列表\r\n       this.assign(\"tab\",tab);\r\n       return this.displayView(\"index_index\");\r\n\r\n  }\r\n  async itemAction(){\r\n    let tid= await this.get(\"tid\");\r\n    let uinfo=await this.session('uInfo');\r\n    let islogin=(!think.isEmpty(uinfo))?1:0;\r\n    this.assign(\"islogin\",islogin);\r\n    if(!think.isEmpty(uinfo)){\r\n      let loginuserinfo=await this.model('topic').findAll('user',{name:uinfo.name});\r\n      this.assign(\"loginuserinfo\",loginuserinfo[0]);\r\n      //获取收藏信息\r\n      let collectList=await this.model('topic').findAll('user_collect',{aid:tid,type:'topic',author:uinfo.name,iscollect:1});\r\n      if(collectList.length>0){\r\n        this.assign(\"cid\",collectList[0].id);\r\n        this.assign(\"iscollect\",1);\r\n      }else {\r\n        this.assign(\"cid\",\"\");\r\n        this.assign(\"iscollect\",0);\r\n      }\r\n    }else{\r\n      this.assign(\"loginuserinfo\",{});\r\n    }\r\n\r\n    // 获取回复列表\r\n    let replyList=await this.model(\"topic\").getReplyListInfo({tid:tid});\r\n    this.assign(\"replyList\",replyList);\r\n\r\n    let topicInfo=await this.model(\"topic\").findOne(\"topic\",{id:tid});\r\n    if(!think.isEmpty(topicInfo)){\r\n      let topicItem=await this.model(\"topic\").findOne(\"topic_item\",{name:topicInfo.item});\r\n      let viewcount=await this.model(\"topic\").where({id:tid}).increment('view',1);\r\n      this.assign('topicInfo',topicInfo);\r\n      this.assign(\"replycount\",topicInfo.replycount);\r\n      this.assign('topicItem',topicItem.comment);\r\n      return this.displayView(\"index_item\");\r\n\r\n    }else{\r\n      return this.displayView(\"../common/error_404\");\r\n    }\r\n  }\r\n\r\n  async editAction(){\r\n    let tid= await this.get(\"tid\");\r\n    let replyInfo=await this.model(\"topic\").findOne(\"topic_comment\",{id:tid});\r\n    let topicInfo=await this.model(\"topic\").findOne(\"topic\",{id:replyInfo.tid});\r\n    this.assign(\"title\",\"回复编辑\");\r\n    this.assign(\"replyInfo\",replyInfo);\r\n    this.assign(\"topicInfo\",topicInfo);\r\n    return this.displayView(\"index_edit\");\r\n  }\r\n}\r\n"
    ]
}